last week we did an overview of the model context protocol or mCP this week we are going to dig into the details on these e-commerce application we're going to first build tools to connect it to the products API then we're going to build an mCP server to connect to the orders API and give our mCP client of the web server the ability to make orders and then we're going to do some business intelligence and take Claude and connect it to that mCP server it is amazing stuff Let's Get Right into [Music] it all right so here's our example e-commerce application all of this code is Avail to you of course for free in GitHub and a link in the description right down below now this is a pretty simple site we got our homepage right here you can click on a guitar see the detail on that guitar really beautiful but there's also this really neat AI assistant now this AI assistant is designed to help the customer figure out what guitar they want to buy so we'll say can you recommend a techy looking guitar now in our product catalog we have the motherboard guitar which be a perfect fit for that let's see what the AI assistant comes up with well the AI assistant right now is telling us that we should go for a ianz or a Parker or a strandberg none of those is us well we don't actually exist so what we want to do is give it access to our product catalog but before we do that let's take a look at the systems architecture of this to figure out exactly what's going on so what you just saw there was the front end it's a tan stack start application running on Port 3000 it connects to the products API which is an Express app on Port 882 so what that allows it to do is get the list of guitars so you can do the homepage get guitar guitar details so you can go and show the detail page now what's missing obviously is that AI assistant that does not connect to the product CPI and that's why it's giving us those off recommendations so that's job number one we're going to go and connect that AI assistant to that product's API using tools and then understanding how tools work will be able to understand how to get tools to work within the context of an mCP server but before we get into that let me just quickly finish up the systems architecture as it is we also have a fulfillment API again Express on Port 880 and we have an admin app also a TX start app and that's on Port 3001 that's going to allow us to take a look to see what the fulfilled orders are so now let's start talking about how we're going to connect our AI assistant to our products API so obviously the front end has no issues right now connecting just directly to the llm and asking it basic questions but what we really want is we want that llm to have access to our products API so that's where tools come in and understand how tools work you have to understand the message flow of an application so You' got the client and the server on the front end the client in this case is the AI assistant which is say for example that I type in say hello into that assistant that goes to the server server then sends that to the llm the llm then goes on adds onto that messages list the message message history that hello how can I help you that kind of thing and it sends that back now let's talk about a tool flow so let's start off with something that requires a tool like please recommend a guitar again we add that in the messages just as we did before that goes to the server now the server then sends that off to the llm but this time it adds a little bit extra gives a tools definition and those tools are defined at The Meta level they say they exist and what the parameters are but there's no way to actually execute on those as we'll see in a second so the llm gets the message it gets the tools it then sends back as part of that message history hey I need to know what those products are so make a tool call you as the server to get the products you said that you had that tool please execute it for me so now the server that does have access to that product API makes the request the product API and sends back the data and then we take that Json and we add it into the message list as the result of that tool call then we send that to the llm now the llm has the original customer query it now has the content from that tool call and it can go and give us a recommendation as part of that message history and there it is that's how the tool flow works with an llm so let's actually try this in code all right here's the NX mon repo it has all the applications I've been talking about the one that we're most interested in that has the AI assistant is the front end so let's go in there we'll take a look at AI tool now this is a function that Returns the tools that are available to the AI so what we want to do is Implement our first tool so we'll bring in the tool function from the versal AI Library we'll bring in our fetch guitars helper function from the apis that fetch guitars function makes a simple call to the products on 882 and now we'll Define our first tool get products and would give it a description to just get all the products from the database now that's a good thing for the AI so they can understand conceptually how and when to use this particular tool it also needs parameters so we're going to need to bring in Zod for that now in this case there's no parameters you can add any parameters you want and describe them and then there's an execute function so tools that run on the server need an execute function and then in this case execute is going to call that fetch guitars function to go and get the data from our product API now we add that to our object that has all of our tools and now we just need to go and take this over to ai. TS and bring it in so import get tools and then we'll go down here to where we actually make the call to the AI now our call to the AI uses versal ai's stream text function and it gives it the model in this case anthropic you could use open AI you can use any model you want it just has to have support for Tool calls we give it the messages which would be that array of messages that we saw there's a system prompt in this case the system prompt is so far you're an AI for a music store now I'll get to Max steps in a second but let's go and get our tools and then we'll give them to the AI and let's see this actually work so go back over here to our Arc we'll go to our AI assistant and this time again I'll ask it for a techie guitar all right so it's saying that it's checking our product catalog for guitars that match that description and there it is the motherboard guitar awesome so it's made the right choice and now it's working off of our product catalog awesome now let's go back in the code and there's two more things I want to talk about and the first is the system prompt sometimes it's good to actually hint to the AI that you want it to use those tools so for example you can say there are products available for purchase you can R recommend a product to the user and then tell it to use that get products tool so if you're having issues with it not using your tools then you can go and add some extra reinforcement in your system prompt now the other thing is around Max steps so we went all through the flow here and you can see the highlighted section is around the tool call now there's actually multiple steps that the AI needed to take to accomplish the query we said please recommend a guitar so it had to step one request a tool call that got back the tool call data and then step two was to analyze that data and provide that recommendation so you have two steps there and by default the AI Library limits the number of steps to one so if you're going to use tool calls I strongly recommend setting Mech steps to something more than one all right so far we've been talking about what I call server tools and those are tools that are run on the server but there's another type of tools client tools and client tools as you might guest are run on the client I mentioned them in an mCP video because it's important to understand that mCP is not good for client tools mCP is good for Server tools mcps run on either servers or on your command line they don't have access to the client by default so you need to understand that client tools exist and what they might be useful for so let's take away the server and let's try a new tool call this one's called recommend guitar after it's figured out what guitar you want maybe there's a new tool call that allows it to go and on the client have a special card that says this guitar in particular right so what we're going to do is we're going to have a recommend guitar tool call it gives us the ID as an argument and then we put in a nice card there that shows the guitar and allows them to go into the view detail page and see more about that Guitar let's give it a try let's go back into our AI tools and we'll create a new tool called recommended Guitar use this tool to recommend a guitar to the user and it'll have an ID as a parameter on it and will tell it that that is the ID of the guitar you want to recommend now we'll add that to the list of tools and the next thing we need to do is actually go over to the UI and make sure that that is accounted for so we go over to our AI assistant we'll scroll down to the used chat hook that's where we make the actual request to our geni response server function and we'll add a new message Handler called on tool call and it says hey when you get a tool call recommend guitar just say we are going to handle that on the UI side now you could actually take some action at this point if you had for for example a a GPS tool it can make a GPS call and then add onto the messages the result of that GPS call you could actually do things on the client but in this case we're just going to have it recommend the guitar to do that we're going to go back to our messages component which is right here at the top it shows all the array of messages and we're going to go right down below where it actually shows the text of the message and then we're going to add on that if we have any additional parts to the message which would involve tool invocations we're going to see if that type is a tool invocation and if it's recommend guitar and and in that case we'll use our guitar recommendation component and give it the ID let's go bring in that guitar recommendation component and see how our new client tool goes let's go back over to our AI assistant and again Ask it for techie guitar all right looks like it's got the correct guitar and awesome it's got our card in there it's in place looks great let's go and click on view details beautiful that that's really what you want that's what you want from an AI assistant you want it to actually be integrated not just be text be multimodal it's beautiful but what you also want from an AI assistant is to be truly helpful in this case it would be really great if it could allow us to make an order so now I've got this techie Guitar let's go buy it so back to our systems architecture diagram we fixed the issue with it connecting the AI assistant to the products API but now we wanted to connect to the Fulfillment API so that we can actually have that AI assistant make orders on behalf of the customer but it can't do that currently because it's got no connection so we're going to try tools again but we're not going to put them inside the server we're going to put them inside an mCP server so here's the flow that we saw before there are server tools the server is going to get a tool call request to say order a product it's then going to make a request to the mCP order server to handle that tool call that mCP order service is going to talk to that orders API and send it back to the server so the flow is basically the same we're just putting that mCP order server in the middle of that flow the big advantage of having that mCP order server in there is that the front end in this case is only one client to that mCP order servers you can have others like Claude or cursor or winds surf or any other mCP client because an mCP parlance all of these are mCP clients and all those connections are transports part of the transport layer now the first transport that we're going to take a look at is ssse so we're going to have our front-end server talk to that mCP order server over SS or server sent events which is running over HTTP or htps I'm going to go into the abst directory and I'm going to create an mCP ORD server I'm going to do pmpn nit to initialize that project and then I'm going to add some required libraries the model context protocol SDK so we can build our server Zod so we can specify the parameters and then Express because we we are s mCP server and we run over htps so Express is going to handle all that for us okay let's go in there and I'll create a new server.js file and I'll bring in mCP server so we can Define our mCP server mCP server is a class so we're going to use new to instantiate an object from that class called server and then we can Define our first tool we'll call it get inventory it gets the product inventory and you give it an execute function so in this case we're just going to call off to inventory and get the inventory and then pass that back as textify Json we'll also get a purchase tool so now a customer can use that mCP server to purchase a product I have to specify some parameters in this case items which would be all the items of your carts so each guitar as well as the quantity as well as a customer name obviously you'd want more than this but this is fine for a demo and the implementation of that again calls 8080 in this case the endpoint there is purchase and just sends along the data as the body all right let's fire this up by first creating an Express server we'll set it up to listen on Port 881 and then will create two endpoints the first is a get request to/ SSE that will create the start of the stateful connection between the mCP client and the mCP server now there is a PR in flight to make an stateless variant of this but currently is a stateful connection between those two things in addition to SLS we also have SL messages and that's where the MCB client will post messages that come in and get those responses back so there we go codewise one last thing to do before we get this fired up is to make this a type of module in the package Json and now we can run it let's give it a go nodes server.js excellent now it's running on Port 881 let's take a look and we get this nice little thing that tells us hey you're connected and when you want to send me messages talk to this data endpoint cool okay so let's fire it up and let's go connect it to our front end server so go back over here to our AI my tools and bring in the experimental mCP client from Ai and then we'll run that experimental create mCP client function and tell it that our s mpoint is on Local Host 881 we call it the order service and now all we need to do is go down here to get tools we'll await the tools coming back from that mCP client We'll add them to our list of tools and now we can go and make orders I do want to go back into AI though and make sure that in our system prompt we're telling the system to use get inventory and purchase all right let's give it a go now before we do that let's go over to our admin server so here's our admin server with our inventory we got five units of this nine units of this so on so forth and our orders so we expect to see a new order come on up here if this works so okay let's go and say please order me two motherboard guitars I'm really in love with them my name is Jack okay so now it's going to check the products in the inventory awesome so it's going to the inventory and it sees that the motherboard guitar is available in stock and it has now made the order it's $1,298 let's go take a look at our yeah there you go look at that fetching the inventory purchasing fantastic this is this is great let's go take a look at our orders to see that that order came in there we go so now we see the same types of tools but working on an mCP server and the web server in this case an mCP client using that mCP server now there is another type of transport in that standard IO and to demonstrate that what I want to do is do some business intelligence through Claude so Claude is going to use a standard IO request to mCP order service let's give that a try so back over my code I'm going to stop that mCP order server and I'm going to go and extract the logic from here that be the server and I'm going to create a new file called server logic paste that in there now server is exported so we can just simply import server from server logic and this should still work but we're going to call this ssse server and then we're going to make a new one called standard IO server it's going to bring in the standard IO server transport from that model context protocol SDK as well as that server logic then we'll create that transport and connect our server to it to see that it's all working I'm going to go over my command line and run it and I see nothing which in this case is actually good because it's waiting for standard input to actually drive this so what let's go and generate some standard input by going over to Claud and connecting that to Cloud so over in Claud in settings I'm going to go to developer and then edit the config to edit the config I use whatever editor I want so I'm going to use cursor for that and I'm going to give it my mCP server so I'm going to find that I have one mCP server called orders the command is node and the argument is the absolute path of that particular JS file now there is one more thing I want to do over in server logic I want to go and add another tool so that Claud can have access to our orders so I'm going to take this get inventory and I'm going to copy and paste it we'll call it get orders get the product orders return those orders fetching orders that looks good okay so I think we're good to go so let's go back over to our CLA and now I need to restart it so that read reads that configuration file and now that I've restarted it you can see that we have this little mCP icon down there I can see that we have the Fulfillment mCP server attached awesome so ask you to analyze our orders to draw me a graph of our sales and project next month sales let's see how it does I've never actually tried this before okay so it's asking for permission to call that tool great allow it so it's called that get orders tool it's got our orders excellent now it's processing those oh this is so great it's actually writing some code for us this is really cool okay generating some Javas script this is awesome fantastic okay looks like we did okay in January we're doing okay in February uh March is on the rise that's great and April it's it's not looking so good a little bit down but that's okay obviously this is all just fake data but oh my gosh that is so cool check out what we've done we've added business intelligence as well through our mCP server I even liked how it used blue in the bar chart you know blue colar coder that's fantastic all right I hope you enjoyed this applied look at the model context protocol it adds some more depth to the overview that we did last week you now you know more about how to create servers how to create clients how to use your mCP servers in multiple context how that message flow Works between the server and the llm if you have any questions or comments please put that in the comment section right down below and in the meantime if you like this video hit that like button if you really like the video hit the Subscribe button and click on that Bell and you be notified the next some a new blue collar coder comes out